# System Resource Forensics Logger and Visualizer

## 專案概述

這個專案旨在協助診斷 Windows 系統中由特定軟體（例如 EDR, Endpoint Detection and Response 解決方案）或核心服務（如 `lsm.exe`）引起的記憶體或其他資源異常耗用問題。它包含一個 C# 主控台應用程式用於定時記錄系統資源數據，以及一個 Python 腳本用於將這些數據視覺化為互動式 HTML 報表。

## 功能特色

### 1. 系統資源記錄器 (C# Console Application)

*   **定時監控**: 每 5 分鐘自動記錄一次系統資源狀態。
*   **詳細記憶體資訊**:
    *   總實體記憶體 (Total MB)。
    *   可用實體記憶體 (Available MB)。
    *   已使用實體記憶體 (Used MB) 及其百分比 (Usage %)。
    *   **核心集區 (Kernel Pools)**: 監控「非分頁集區 (Non-Paged Pool MB)」和「分頁集區 (Paged Pool MB)」的使用量，這是判斷驅動程式記憶體洩漏的關鍵指標。
*   **進程級別監控**:
    *   記錄當前佔用 **記憶體 (Working Set)** 最高的前 10 個進程名稱及使用量。
    *   記錄當前擁有 **控制代碼 (Handle Count)** 最多（潛在資源洩漏）的前 5 個進程名稱及數量。
*   **數據輸出**: 數據會以 CSV 格式保存到 `yyyy-MM-dd_log.csv` 檔案中，方便後續分析。

### 2. 數據視覺化工具 (Python Script)

*   **自動讀取**: 自動讀取當前目錄下的所有 `*_log.csv` 檔案。
*   **數據優化**: 自動合併計算同名進程（例如多個 `chrome.exe`）的資源用量，避免重複顯示。
*   **互動式報表**: 生成一個名為 `MemoryForensicsReport.html` 的互動式 HTML 檔案，可用瀏覽器直接打開。
*   **小白友善圖表**: 報表包含四個主要圖表，所有記憶體單位統一為 **MB**，並附帶簡易判讀說明：
    1.  **總系統記憶體使用量**: 當紅色區域（已用）接近灰色虛線（總量）時，代表記憶體快被吃光了。
    2.  **核心集區使用量 (驅動程式偵測)**: 專抓驅動程式問題。如果 **橘色線 (Non-Paged Pool)** 持續上升不降，代表驅動程式（如 EDR）有問題。
    3.  **前 5 大應用程式記憶體佔用**: 直接抓出誰是「吃記憶體怪獸」。
    4.  **前 3 大應用程式控制代碼佔用**: 用於偵測資源洩漏。如果 **`lsm.exe`** 或資安軟體出現在這且數值持續上升，通常就是系統變慢的元兇。

## 如何使用

### 必備條件

*   **.NET 8 SDK**: 用於編譯和運行 C# 記錄器。
*   **Python 3.x**: 用於運行視覺化腳本。
*   **Python 庫**: `pandas` 和 `plotly`。

### 設定步驟

1.  **安裝 Python 庫**:
    ```powershell
    pip install pandas plotly
    ```
2.  **恢復 .NET 依賴 (如果這是新 clone 的專案)**:
    在 `SystemResourceLogger` 目錄下執行：
    ```powershell
    dotnet restore
    ```
    （此步驟在你之前已經執行過，通常不需要重複）

### 運行記錄器 (C#)

1.  **重要**: 如果你之前有運行過舊版記錄器且已產生 `.csv` 檔案，請先將它們刪除或移動到其他地方，以確保新版記錄器能夠以正確的格式開始寫入數據。
2.  在 `SystemResourceLogger` 目錄下執行：
    ```powershell
    dotnet run
    ```
    此命令將啟動記錄器並開始每 5 分鐘記錄一次數據。讓它在背景運行一段時間（例如一個晚上），以收集足夠的數據。你可以透過 `Ctrl+C` 停止它。

### 生成報告 (Python)

1.  在 `SystemResourceLogger` 目錄下執行：
    ```powershell
    python VisualizeLog.py
    ```
    此命令將讀取所有 `*_log.csv` 檔案並生成 `MemoryForensicsReport.html`。

### 查看報告

1.  用任何現代瀏覽器（如 Chrome, Edge, Firefox）打開 `MemoryForensicsReport.html` 檔案。
2.  報表是互動式的，你可以放大、縮小、平移，並將滑鼠懸停在數據點上以查看詳細信息。

## 報告判讀指引 (新手懶人包)

*   **圖表 1 (紅線 vs 灰線)**: 紅色是已經用掉的記憶體。如果紅色一直漲，漲到碰到灰色虛線，電腦就會當機。
*   **圖表 2 (橘色線 - 關鍵)**: 這條線代表「驅動程式」用的記憶體。正常應該是平平的。**如果橘色線一直往上爬，這就是問題所在！** 通常是因為防毒軟體或 EDR 驅動程式寫得不好，這就是證據。
*   **圖表 3 (誰吃最多 RAM)**: 這裡列出前 5 名最耗記憶體的程式。如果看到某個程式（例如 `chrome` 或某個業務軟體）線條一路往上衝都不回頭，那就是它在洩漏記憶體。
*   **圖表 4 (lsm.exe 警報)**: 這個圖表專門看「控制代碼 (Handle)」。如果看到 **`lsm.exe`** 的線條一直往上飆，這通常代表它被其他軟體（如 EDR）卡住了，這是導致系統變慢、無法登入的常見原因。

希望這個工具能幫助你有效地診斷問題！
